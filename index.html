<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kleine 3d Szene</title>
	<style>
		body { margin: 0; overflow: hidden; background-color: #111; }
		canvas { display: block; }
	</style>
</head>
<body>
	<script type="importmap">
	{
		"imports": {
			"three": "https://unpkg.com/three@0.160.0/build/three.module.js",
			"three/addons/":"https://unpkg.com/three@0.160.0/examples/jsm/"
		}
	}
	</script>
	<script type="module">
		import * as THREE from 'three';
		import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
		
		// scene setup
		const scene = new THREE.Scene();
		scene.background = new THREE.Color(0x87ceeb);
		const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
		camera.position.y = 2;
		const renderer = new THREE.WebGLRenderer({ antialias:true });
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
		
		// add light
		const light = new THREE.AmbientLight(0x404040, 2);
		scene.add(light);
		const sun = new THREE.DirectionalLight(0xffffff, 1);
		sun.position.set(10, 10, 10);
		scene.add(sun);
		
		// floor
		const floorGeo = new THREE.PlaneGeometry(100, 100);
		const floorMat = new THREE.MeshStandardMaterial( {color:0x555555 });
		const floor = new THREE.Mesh(floorGeo, floorMat);
		floor.rotation.x = -Math.PI / 2;
		scene.add(floor);
		
		// rand cubes
		for(let i=0; i<20; i++) {
			const box = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshStandardMaterial({color: Math.random() * 0xffffff}));
			box.position.set(Math.random()*40-20, 1, Math.random()*40-20);
			scene.add(box);
		}
		
		// controls
		const controls = new PointerLockControls(camera, document.body);
		
		document.addEventListener('click', () => {
			controls.lock();
		});
		
		// movement logic
		let moveForward = false;
		let moveBackward = false;
		let moveLeft = false;
		let moveRight = false;
		const velocity = new THREE.Vector3();
		const direction = new THREE.Vector3();
		
		const oneKeyDown = (event) => {
			switch (event.code) {
				case 'KeyW': moveForward = true; break;
				case 'KeyS': moveBackward = true; break;
				case 'KeyA': moveLeft = true; break;
				case 'KeyD': moveRight = true; break;
			}
		};
		
		const oneKeyUp = (event) => {
			switch (event.code) {
				case 'KeyW': moveForward = false; break;
				case 'KeyS': moveBackward = false; break;
				case 'KeyA': moveLeft = false; break;
				case 'KeyD': moveRight = false; break;
			}
		};
		document.addEventListener('keydown', oneKeyDown);
		document.addEventListener('keyup', oneKeyUp);
		
		
		// animation loop
		let prevTime = performance.now();
		function animate() {
			requestAnimationFrame(animate);
			
			if (controls.isLocked) {
				const time = performance.now();
				const delta = (time - prevTime) / 1000;
				
				velocity.x -= velocity.x * 10.0 * delta;
				velocity.z -= velocity.z * 10.0 * delta;
				
				direction.z = Number(moveForward) - Number(moveBackward);
				direction.x = Number(moveRight) - Number(moveLeft);
				
				// apply movement
				if(moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
				if(moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;
				
				controls.moveRight(-velocity.x * delta);
				controls.moveForward(-velocity.z * delta);
				
				prevTime = time;
			}
			renderer.render(scene, camera);
		}
		
		window.addEventListener('resize', () => {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		});
		animate();
	</script>
</body>
</html>
